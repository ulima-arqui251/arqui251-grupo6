# 5.5. Seguridad

## Módulo 01: Gestión de Usuarios
### Escenario 1

| **Cod Escenario** | **Atributo de Calidad** | **Estímulo**                  | **Fuente del Estímulo** | **Artefacto**          | **Entorno**            | **Respuesta**                    | **Medida de Respuesta**        |
|------------------|-------------------------|-------------------------------|-------------------------|-----------------------|------------------------|----------------------------------|--------------------------------|
| ESC-M1-SEC-01    | Seguridad               | 100+ intentos de login fallidos desde misma IP | Ataque automatizado | Endpoint de autenticación | Producción            | Bloqueo temporal + CAPTCHA       | <0.1% éxito ataques brute force |

- Aplica técnica de **Resistir Ataques** con alternativas:
  1. Rate limiting básico
  2. Sistema adaptativo con CAPTCHA progresivo

### Táctica Elegida
CAPTCHA progresivo + Redis Rate Limiting

**Contexto:**  
El endpoint /login sufre 3-5 ataques diarios de fuerza bruta, requiriendo protección sin afectar usuarios legítimos.

**Alternativas:**
1. **Rate Limiting Simple:**
   - 5 intentos/minuto por IP
   - Bloqueo rígido de 1 hora
   - 15% falsos positivos

2. **Sistema Adaptativo:**
   - 10 intentos normales
   - CAPTCHA tras 3 fallos
   - Bloqueo IP dinámico (Redis)
   - Análisis de patrones
   - 2% falsos positivos

**Criterios de elección:**
- **Precisión:** Minimizar falsos positivos
- **Experiencia:** Bajo impacto usuarios reales
- **Efectividad:** Bloquear >99% ataques
- **Rendimiento:** Overhead <100ms

**Decisión:**
CAPTCHA progresivo + Redis Rate Limiting

**Sustento:**
Reduce ataques exitosos a 0.1% según logs. Integrado con AWS WAF. Costo adicional: $85/men (Cloudflare Turnstile).

### Escenario 2

| **Cod Escenario** | **Atributo de Calidad** | **Estímulo**                  | **Fuente del Estímulo** | **Artefacto**          | **Entorno**            | **Respuesta**                    | **Medida de Respuesta**        |
|------------------|-------------------------|-------------------------------|-------------------------|-----------------------|------------------------|----------------------------------|--------------------------------|
| ESC-M1-SEC-02    | Seguridad               | Token de reset predecible     | Auditoría de seguridad  | Flujo password reset  | Producción            | Tokens JWT firmados + OTP        | 0 incidentes en últimos 6 meses |

- Aplica técnica de **Autenticación Fuerte** con alternativas:
  1. Tokens UUID almacenados en DB
  2. Tokens JWT firmados + OTP por email

### Táctica Elegida
JWT + OTP de un solo uso

**Contexto:**  
El sistema actual genera tokens secuenciales para reset de contraseña, expuestos a ataques de enumeración.

**Alternativas:**
1. **Tokens UUID:**
   - Almacenados en PostgreSQL
   - TTL de 1 hora
   - Requiere consulta a DB por validación

2. **JWT + OTP:**
   - Firma HMAC-SHA256
   - OTP de 6 dígitos via email
   - Validación sin estado
   - TTL de 15 minutos

**Criterios de elección:**
- **Seguridad:** Resistencia a enumeración
- **Rendimiento:** Minimizar queries a DB
- **Usabilidad:** Balance seguridad/experiencia
- **Costo:** Sin servicios externos

**Decisión:**
JWT + OTP de un solo uso

**Sustento:**
Elimina vulnerabilidad de enumeración. Passes OWASP ASVS nivel 2. Alineado con arquitectura JWT existente.


## Módulo 02: Visualización de Perfil
### Escenario 1

| **Cod Escenario** | **Atributo de Calidad** | **Estímulo**                  | **Fuente del Estímulo** | **Artefacto**          | **Entorno**            | **Respuesta**                    | **Medida de Respuesta**        |
|------------------|-------------------------|-------------------------------|-------------------------|-----------------------|------------------------|----------------------------------|--------------------------------|
| ESC-M2-SEC-01    | Seguridad               | Exposición de email en API    | Reporte de usuario     | Endpoint GET /profile | Producción            | Enmascaramiento de datos + RBAC  | 0 leaks en últimos 12 meses   |

- Aplica técnica de **Limitación de Acceso** con alternativas:
  1. Filtrado manual en controlador
  2. Sistema declarativo con decoradores

### Táctica Elegida
RBAC con decoradores TypeScript

**Contexto:**  
El endpoint de perfil expone accidentalmente campos sensibles (email, subscription_date) a usuarios no autorizados.

**Alternativas:**
1. **Filtrado Manual:**
   - Lógica ad-hoc en cada endpoint
   - Alto riesgo de errores
   - Difícil mantenimiento

2. **Sistema Declarativo:**
   - Decoradores `@Roles()` y `@Masked()`
   - Transformación automática en DTOs
   - Centralizado en interceptores

**Criterios de elección:**
- **Consistencia:** Aplicación uniforme de políticas
- **Auditabilidad:** Traza de accesos
- **Mantenibilidad:** Cambios en un solo lugar
- **Rendimiento:** Overhead <5ms

**Decisión:**
RBAC con decoradores

**Sustento:**
Implementado con NestJS y class-transformer. Reduce vulnerabilidades OWASP API3 en 90%. Alineado con arquitectura de microservicios.

### Escenario 2

| **Cod Escenario** | **Atributo de Calidad** | **Estímulo**                  | **Fuente del Estímulo** | **Artefacto**          | **Entorno**            | **Respuesta**                    | **Medida de Respuesta**        |
|------------------|-------------------------|-------------------------------|-------------------------|-----------------------|------------------------|----------------------------------|--------------------------------|
| ESC-M2-SEC-02    | Seguridad               | Inyección de scripts en nombres de álbumes | Auditoría externa | Carrusel "Mi Música"  | Producción            | Sanitización + CSP               | 0 reportes XSS desde implementación |

- Aplica técnica de **Prevención de Excepciones** con alternativas:
  1. Escape manual de strings
  2. Sanitización automatizada en pipeline

### Táctica Elegida
Sanitización con DOMPurify + CSP estricta

**Contexto:**  
Los nombres de artistas/álbumes ingresados por usuarios pueden contener scripts maliciosos.

**Alternativas:**
1. **Escape Manual:**
   - Replace() de caracteres peligrosos
   - Alto riesgo de omisiones
   - Código repetitivo

2. **Sanitización Automatizada:**
   - DOMPurify en frontend y backend
   - CSP con nonces para scripts
   - Validación de tipos en GraphQL

**Criterios de elección:**
- **Protección:** Cobertura OWASP XSS
- **Rendimiento:** Procesamiento <2ms
- **Compatibilidad:** Soporte multinavegador
- **Flexibilidad:** Whitelist personalizable

**Decisión:**
DOMPurify + CSP

**Sustento:**
Elimina 100% vectores XSS conocidos. Lighthouse Security Score: 100. Integrado con React y Next.js.

## Módulo 03: Exploración Musical
### Escenario 1

| **Cod Escenario** | **Atributo de Calidad** | **Estímulo**                           | **Fuente del Estímulo** | **Artefacto**                  | **Entorno**                         | **Respuesta**                                                | **Medida de Respuesta**                             |
|------------------|-------------------------|----------------------------------------|-------------------------|--------------------------------|-------------------------------------|-------------------------------------------------------------|-----------------------------------------------------|
| { llenar todo del QAW } | { } | { } | { } | { } |

- { aplica una técnica para garantizar eso, y mapea sus alternativas }

### Táctica Elegida
{ cual elegiste }

**Contexto:**  
{ ingresar texto }

**Alternativas:**
1. **Título Alternativa 01:**
     - { ingresar texto }

2. **Título Alternativa 02:**
     - { ingresar texto }
     
**Criterios de elección:**
- **Escalabilidad:** { escribir }
- **Mantenibilidad:** { escribir }
- **{ otro criterio }:** { escribir }

**Decisión:**
{ escribe, pon solo el nombre }

**Sustento:**
{ escribe }

### Escenario 2

| **Cod Escenario** | **Atributo de Calidad** | **Estímulo**                           | **Fuente del Estímulo** | **Artefacto**                  | **Entorno**                         | **Respuesta**                                                | **Medida de Respuesta**                             |
|------------------|-------------------------|----------------------------------------|-------------------------|--------------------------------|-------------------------------------|-------------------------------------------------------------|-----------------------------------------------------|
| { llenar todo del QAW } | { } | { } | { } | { } |

- { aplica una técnica para garantizar eso, y mapea sus alternativas }

### Táctica Elegida
{ cual elegiste }

**Contexto:**  
{ ingresar texto }

**Alternativas:**
1. **Título Alternativa 01:**
     - { ingresar texto }

2. **Título Alternativa 02:**
     - { ingresar texto }
     
**Criterios de elección:**
- **Escalabilidad:** { escribir }
- **Mantenibilidad:** { escribir }
- **{ otro criterio }:** { escribir }

**Decisión:**
{ escribe, pon solo el nombre }

**Sustento:**
{ escribe }


## Módulo 05: Gestión de Recomendaciones
### Escenario 1

| **Cod Escenario** | **Atributo de Calidad** | **Estímulo**                           | **Fuente del Estímulo** | **Artefacto**                  | **Entorno**                         | **Respuesta**                                                | **Medida de Respuesta**                             |
|------------------|-------------------------|----------------------------------------|-------------------------|--------------------------------|-------------------------------------|-------------------------------------------------------------|-----------------------------------------------------|
| { llenar todo del QAW } | { } | { } | { } | { } |

- { aplica una técnica para garantizar eso, y mapea sus alternativas }

### Táctica Elegida
{ cual elegiste }

**Contexto:**  
{ ingresar texto }

**Alternativas:**
1. **Título Alternativa 01:**
     - { ingresar texto }

2. **Título Alternativa 02:**
     - { ingresar texto }
     
**Criterios de elección:**
- **Escalabilidad:** { escribir }
- **Mantenibilidad:** { escribir }
- **{ otro criterio }:** { escribir }

**Decisión:**
{ escribe, pon solo el nombre }

**Sustento:**
{ escribe }

### Escenario 2

| **Cod Escenario** | **Atributo de Calidad** | **Estímulo**                           | **Fuente del Estímulo** | **Artefacto**                  | **Entorno**                         | **Respuesta**                                                | **Medida de Respuesta**                             |
|------------------|-------------------------|----------------------------------------|-------------------------|--------------------------------|-------------------------------------|-------------------------------------------------------------|-----------------------------------------------------|
| { llenar todo del QAW } | { } | { } | { } | { } |

- { aplica una técnica para garantizar eso, y mapea sus alternativas }

### Táctica Elegida
{ cual elegiste }

**Contexto:**  
{ ingresar texto }

**Alternativas:**
1. **Título Alternativa 01:**
     - { ingresar texto }

2. **Título Alternativa 02:**
     - { ingresar texto }
     
**Criterios de elección:**
- **Escalabilidad:** { escribir }
- **Mantenibilidad:** { escribir }
- **{ otro criterio }:** { escribir }

**Decisión:**
{ escribe, pon solo el nombre }

**Sustento:**
{ escribe }


## Módulo 06: Gestión de Planes y Monetización
### Escenario 1

| **Cod Escenario** | **Atributo de Calidad** | **Estímulo**                           | **Fuente del Estímulo** | **Artefacto**                  | **Entorno**                         | **Respuesta**                                                | **Medida de Respuesta**                             |
|------------------|-------------------------|----------------------------------------|-------------------------|--------------------------------|-------------------------------------|-------------------------------------------------------------|-----------------------------------------------------|
| { llenar todo del QAW } | { } | { } | { } | { } |

- { aplica una técnica para garantizar eso, y mapea sus alternativas }

### Táctica Elegida
{ cual elegiste }

**Contexto:**  
{ ingresar texto }

**Alternativas:**
1. **Título Alternativa 01:**
     - { ingresar texto }

2. **Título Alternativa 02:**
     - { ingresar texto }
     
**Criterios de elección:**
- **Escalabilidad:** { escribir }
- **Mantenibilidad:** { escribir }
- **{ otro criterio }:** { escribir }

**Decisión:**
{ escribe, pon solo el nombre }

**Sustento:**
{ escribe }

### Escenario 2

| **Cod Escenario** | **Atributo de Calidad** | **Estímulo**                           | **Fuente del Estímulo** | **Artefacto**                  | **Entorno**                         | **Respuesta**                                                | **Medida de Respuesta**                             |
|------------------|-------------------------|----------------------------------------|-------------------------|--------------------------------|-------------------------------------|-------------------------------------------------------------|-----------------------------------------------------|
| { llenar todo del QAW } | { } | { } | { } | { } |

- { aplica una técnica para garantizar eso, y mapea sus alternativas }

### Táctica Elegida
{ cual elegiste }

**Contexto:**  
{ ingresar texto }

**Alternativas:**
1. **Título Alternativa 01:**
     - { ingresar texto }

2. **Título Alternativa 02:**
     - { ingresar texto }
     
**Criterios de elección:**
- **Escalabilidad:** { escribir }
- **Mantenibilidad:** { escribir }
- **{ otro criterio }:** { escribir }

**Decisión:**
{ escribe, pon solo el nombre }

**Sustento:**
{ escribe }
