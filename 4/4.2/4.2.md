# 4.2. Modelo de Coordinación

## 00: Decisiones generales

### Decisión 1:  
**Título:**
- Mecanismo de comunicación entre microservicios

**Contexto:**  
Dado que hemos optado por una arquitectura de microservicios, es crucial definir cómo se comunicarán los diferentes servicios entre sí para intercambiar información y coordinar acciones. Esta decisión impactará la latencia, la confiabilidad y la complejidad general del sistema.

**Alternativas:**
1. **Comunicación síncrona (RESTful API):**
     - Los microservicios se comunican directamente entre sí a través de solicitudes HTTP.
     - Simple de implementar para interacciones request/response.
     - Puede generar acoplamiento temporal entre servicios: el servicio A debe estar disponible para que el servicio B complete su operación.
     - La latencia puede aumentar si hay múltiples llamadas encadenadas.

2. **Comunicación asíncrona basada en eventos (Message Broker):**
     - Los microservicios se comunican a través de un intermediario (ej. RabbitMQ, Kafka) intercambiando mensajes o eventos.
     - Promueve el desacoplamiento temporal y espacial entre servicios.
     - Mejora la resiliencia: si un servicio está temporalmente inactivo, los mensajes se encolan y se procesan cuando vuelve a estar en línea.
     - Introduce la necesidad de una infraestructura de mensajería y puede ser más complejo de implementar para ciertos patrones de interacción (ej. request/response directo).
     - Facilita la escalabilidad y la adición de nuevos consumidores de eventos en el futuro.
     
**Criterios de elección:**
- **Desacoplamiento:** Minimizar las dependencias directas entre servicios.
- **Resiliencia:** La capacidad del sistema para seguir funcionando en caso de fallos temporales de algún servicio.
- **Escalabilidad:** La capacidad de manejar un gran volumen de interacciones entre servicios.
- **Latencia:** El tiempo de respuesta para las operaciones que involucran múltiples servicios.
- **Complejidad de Implementación:** El esfuerzo necesario para configurar y mantener el mecanismo de comunicación.

**Decisión:**
Utilizar una combinación de comunicación síncrona (RESTful API) para interacciones request/response directas y comunicación asíncrona basada en eventos (a través de un Message Broker) para coordinar acciones que no requieren una respuesta inmediata y para la difusión de cambios de estado.

**Sustento:**
Una estrategia híbrida permite aprovechar los beneficios de ambos enfoques. La comunicación síncrona es adecuada para operaciones donde se necesita una respuesta inmediata (ej. consultar el perfil de un usuario). La comunicación asíncrona basada en eventos es más apropiada para coordinar acciones entre servicios que no requieren una respuesta inmediata y para propagar cambios de estado (ej. cuando se valora una canción, se emite un evento para actualizar el estado del álbum y del artista en la biblioteca del usuario). Esto promueve el desacoplamiento, mejora la resiliencia y facilita la escalabilidad del sistema.

## 01: Gestión de Usuarios

### Decisión 1:  
**Título:**
- { a }

**Contexto:**  
{ ingresar texto }

**Alternativas:**
1. **Alternativa 01:**
     - { ingresar texto }

2. **Alternativa 02:**
     - { ingresar texto }
     
**Criterios de elección:**
- **Escalabilidad:** { escribir }
- **Mantenibilidad:** { escribir }
- **{ otro criterio }:** { escribir }

**Decisión:**
{ escribi }

**Sustento:**


## 02: Visualización de perfil

### Decisión 1:  
**Título:**
- 

**Contexto:**  
{ ingresar texto }

**Alternativas:**
1. **Alternativa 01:**
     - { ingresar texto }

2. **Alternativa 02:**
     - { ingresar texto }
     
**Criterios de elección:**
- **Escalabilidad:** { escribir }
- **Mantenibilidad:** { escribir }
- **{ otro criterio }:** { escribir }

**Decisión:**
{ escribi }

**Sustento:**



## 03: Exploración musical

### Decisión 1:  
**Título:**
- { a }

**Contexto:**  
{ ingresar texto }

**Alternativas:**
1. **Alternativa 01:**
     - { ingresar texto }

2. **Alternativa 02:**
     - { ingresar texto }
     
**Criterios de elección:**
- **Escalabilidad:** { escribir }
- **Mantenibilidad:** { escribir }
- **{ otro criterio }:** { escribir }

**Decisión:**
{ escribi }

**Sustento:**



## 04: Gestión de biblioteca

### Decisión 1:  
**Título:**
- Coordinación para la eliminación de artistas y sus álbumes asociados.

**Contexto:**  
Cuando un usuario elimina un artista de su biblioteca, todos los álbumes asociados a ese artista también deben ser eliminados. Es necesario definir cómo se coordinará esta operación entre los diferentes componentes del módulo de Gestión de Biblioteca (o potencialmente con otros módulos si la información de la biblioteca está distribuida).

**Alternativas:**
1. **El microservicio de Gestión de Biblioteca maneja la eliminación en cascada directamente:**
     - Al recibir una solicitud para eliminar un artista, el microservicio de Gestión de Biblioteca sería responsable de identificar y eliminar todos los álbumes asociados de la biblioteca del usuario.
     - Mantiene la lógica de eliminación en un solo lugar.
     - Podría volverse complejo si las relaciones entre artistas y álbumes se almacenan de forma distribuida.

2. **El microservicio de Gestión de Biblioteca emite un evento de "ArtistaEliminado" que es consumido por otros componentes para eliminar los álbumes asociados:**
     - Al eliminar un artista, el microservicio de Gestión de Biblioteca emitiría un evento que indique qué artista ha sido eliminado para un usuario específico.
     - Otros componentes (ej. el almacenamiento de la biblioteca de álbumes) escucharían este evento y realizarían la eliminación de los álbumes correspondientes.
     - Promueve el desacoplamiento y permite que diferentes partes del sistema reaccionen a la eliminación de un artista.
     - Requiere una infraestructura de mensajería.
     
**Criterios de elección:**
- **Consistencia de Datos:** Asegurar que tanto el artista como sus álbumes se eliminen de manera confiable.
- **Desacoplamiento:** Minimizar las dependencias entre los componentes responsables de la gestión de artistas y álbumes en la biblioteca.
- **Escalabilidad:** La capacidad de manejar un gran número de eliminaciones sin afectar el rendimiento.

**Decisión:**
El microservicio de Gestión de Biblioteca maneja la eliminación en cascada directamente.

**Sustento:**
Dado que la relación entre artistas y sus álbumes dentro de la biblioteca de un usuario es un concepto relativamente local al módulo de Gestión de Biblioteca, manejar la eliminación en cascada directamente dentro de este microservicio simplifica la coordinación. No es necesario introducir la complejidad de la mensajería para esta operación específica, siempre y cuando la lógica de eliminación sea robusta y transaccional para asegurar la consistencia de los datos.

### Decisión 2:  
**Título:**
- Coordinación del proceso de valoración de álbumes y la activación de la opción "guardar".

**Contexto:**  
La opción de "guardar" la valoración de un álbum solo debe activarse cuando todas las canciones del álbum han sido valoradas. Es necesario definir cómo se coordinará el estado de las valoraciones de las canciones con la habilitación de la opción "guardar" en la interfaz de usuario.

**Alternativas:**
1. **El frontend consulta al backend (microservicio de Valoración Musical) para verificar si todas las canciones han sido valoradas antes de habilitar el botón "guardar":**
     - Cuando el usuario interactúa con la página de valoración de un álbum, el frontend realizaría una llamada al backend para determinar si todas las canciones tienen una valoración.
     - Simple de implementar inicialmente.
     - Puede generar múltiples llamadas al backend y aumentar la latencia.
     - La lógica de "álbum completo valorado" reside en el backend.

2. **El backend (microservicio de Valoración Musical) notifica al frontend (a través de un canal en tiempo real) cuando todas las canciones de un álbum han sido valoradas para que el frontend habilite el botón "guardar":**
     - El backend rastrearía el estado de valoración de cada canción de un álbum.
     - Cuando se detecta que todas las canciones han sido valoradas, el backend enviaría una notificación al frontend (ej. a través de WebSockets).
     - Reduce las llamadas innecesarias desde el frontend.
     - Requiere la implementación de un canal de comunicación en tiempo real.
     - La lógica de "álbum completo valorado" reside en el backend.
     
3. **El frontend mantiene el estado de las valoraciones y habilita el botón "guardar" localmente, y luego envía todas las valoraciones al backend al guardar:**
     - El frontend rastrearía si el usuario ha valorado todas las canciones mostradas.
     - El botón "guardar" se habilitaría localmente en el navegador cuando se cumplen las condiciones.
     - Al hacer clic en "guardar", todas las valoraciones se envían al backend.
     - Reduce la comunicación constante con el backend durante el proceso de valoración.
     - Requiere que el frontend tenga la lógica para determinar si un álbum está completamente valorado.

**Criterios de elección:**
- **Experiencia del Usuario:** La inmediatez con la que se habilita el botón "guardar".
- **Eficiencia:** Minimizar la comunicación innecesaria entre el frontend y el backend.
- **Separación de Responsabilidades:** Mantener la lógica de negocio en el backend.

**Decisión:**
El backend (microservicio de Valoración Musical) notifica al frontend (a través de un canal en tiempo real) cuando todas las canciones de un álbum han sido valoradas para que el frontend habilite el botón "guardar".

**Sustento:**
Este enfoque proporciona una buena experiencia de usuario al habilitar el botón "guardar" de forma casi inmediata una vez que se completa la valoración. Al mantener la lógica de "álbum completamente valorado" en el backend, se asegura la consistencia de las reglas del negocio. La implementación de un canal en tiempo real (como WebSockets) permite una comunicación eficiente y reactiva entre el backend y el frontend para esta funcionalidad específica.

## 05: Gestión de recomendaciones

### Decisión 1:  
**Título:**
- { a }

**Contexto:**  
{ ingresar texto }

**Alternativas:**
1. **Alternativa 01:**
     - { ingresar texto }

2. **Alternativa 02:**
     - { ingresar texto }
     
**Criterios de elección:**
- **Escalabilidad:** { escribir }
- **Mantenibilidad:** { escribir }
- **{ otro criterio }:** { escribir }

**Decisión:**
{ escribi }

**Sustento:**



## 05: Gestión de planes

### Decisión 1:  
**Título:**
- { a }

**Contexto:**  
{ ingresar texto }

**Alternativas:**
1. **Alternativa 01:**
     - { ingresar texto }

2. **Alternativa 02:**
     - { ingresar texto }
     
**Criterios de elección:**
- **Escalabilidad:** { escribir }
- **Mantenibilidad:** { escribir }
- **{ otro criterio }:** { escribir }

**Decisión:**
{ escribi }

**Sustento:**

